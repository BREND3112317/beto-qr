<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css?family=Montserrat:300,400&display=swap" rel="stylesheet">
    <link href="./css/bootstrap.min.css" rel="stylesheet">
    <title>Document</title>
    <style>
        html, body {
            background-color: #f1f3f4;
            padding: 0;
            margin: 0;
            display: flex;
            flex-direction: column;
        }

        .navbar-brand-beto {
            width: 100%;
            background-color: #00254d;
            padding: 0;
            margin: 0;
        }

        .main {
            width: 100%;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
        }

        .QRCode {
            transition: opacity 0.5 linear;
        }
    </style>
</head>
<body>
    <header class="navbar-brand-beto">
        <div class="container d-flex justify-content-center">
            <a>
                <img src="./img/beto_logo.png" alt="" width="220" height="88">
            </a>
        </div>
    </header>
    <div class="main">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-12 col-md-10 col-lg-8 col-xl-6 pt-4 d-flex justify-content-center">
                    <div class="input-group">
                        <span class="input-group-text">網址</span>
                        <textarea id="input-url" class="form-control"  placeholder="https://www.beto.com.tw/" aria-label="https://www.beto.com.tw/" aria-label="URL"></textarea>
                    </div>
                    
                </div>
                <div class="col-12 col-md-10 col-lg-8 col-xl-6 pt-4 d-flex justify-content-center">
                    <form class="row needs-validation" novalidate>
                        <label for="MainOption" class="form-label">Main Option</label>
                        <div class="col-md-4">
                            <div class="input-group has-validation">
                                <span class="input-group-text" id="inputGroupPrepend">Color</span>
                                <input type="color" class="form-control form-control-color" id="input-DotsColor" value="#000" title="Dots Color">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="input-group has-validation">
                                <span class="input-group-text" id="inputGroupPrepend">Color</span>
                                <input type="color" class="form-control form-control-color" id="input-DotsColor" value="#000" title="Dots Color">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="input-group has-validation">
                                <span class="input-group-text" id="inputGroupPrepend">Color</span>
                                <input type="color" class="form-control form-control-color" id="input-DotsColor" value="#000" title="Dots Color">
                            </div>
                        </div>
                    </form>
                </div>
                <div class="col-12 col-md-10 col-lg-8 col-xl-6 pt-4 d-flex justify-content-center">
                    <form class="row needs-validation" novalidate>
                        <label for="DotsStyle" class="form-label">Dots</label>
                        <div class="col-md-8">
                            <div class="input-group has-validation">
                                <span class="input-group-text" id="inputGroupPrepend">Style</span>
                                <select class="form-select" id="input-DotsStyle" required>
                                    <option selected value="square">Square</option>
                                    <option>Dots</option>
                                    <option>Rounded</option>
                                    <option>Extra Rounded</option>
                                    <option>Classy</option>
                                    <option>Classy Rounded</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="input-group has-validation">
                                <span class="input-group-text" id="inputGroupPrepend">Color</span>
                                <input type="color" class="form-control form-control-color" id="input-DotsColor" value="#000" title="Dots Color">
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            <div class="row justify-content-center">
                <div class="col-12 d-flex pt-2 justify-content-center">
                    <button id="GenerateQR-btn" class="btn btn-primary">生成QR Code</button>
                </div>
            </div>
            <div class="row justify-content-center">
                <div class="col-12 col-md-6 pt-2 d-flex justify-content-center">
                    <div class="row justify-content-center">
                        <div id="QRCode" class="rounded col-12" style="transition: opacity 0.25 linear;"></div>
                    </div>
                </div>
            </div>
            <div class="row justify-content-center">
                <div class="col-12 d-flex pt-2 justify-content-center">
                    <button id="DownloadQR-btn" class="btn btn-outline-danger">下載QR Code</button>
                </div>
            </div>
        </div>
    </div>
    
    <script type="text/javascript" src="./js/jquery.min.js"></script>
    <script type="text/javascript" src="./js/qr-code-styling.js"></script>
    <script src="./js/bootstrap.bundle.min.js" integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4" crossorigin="anonymous"></script>
    <script>
        const qrCode = new QRCodeStyling();

        document.addEventListener("DOMContentLoaded", function(){
            console.log("Loaded");
            let url = new URL(window.location);
            set_inputParam(url);

            pre_generateQR();
            $("#GenerateQR-btn").on("click", function(){ 
                pre_generateQR();
            });
            $("#DownloadQR-btn").on("click", function(){ 
                downloadQR();
            });
        });

        set_inputParam = function (url) {
            let params = url.searchParams;
            for (let pair of params.entries()) {
                $(`#input-${pair[0]}`).val(pair[1]);
                console.log(`key: ${pair[0]}, value: ${pair[1]}`);
            }
        }

        pre_generateQR = function() {
            //document.getElementById("QRCode").getElementsByClassName("svg").remove();
            console.log("tset")
            $("#QRCode").css("opacity", 0);
            
            var options={};
            options.data = $("#input-url").val();
            if(options.data.length<=0){
                options.data="https://www.beto.com.tw/";
            }
            try { // statements to try
                options.eCL = 'H';
                generateQR(options);
            }
            catch (e) {
                try { // statements to try
                    options.eCL = 'Q';
                    generateQR(options);
                }
                catch (e) {
                    try { // statements to try
                        options.eCL = 'M';
                        generateQR(options);
                    }
                    catch (e) {
                        try { // statements to try
                            options.eCL = 'L';
                            generateQR(options);
                        }
                        catch (e) {
                            console.log("[Error]", e)
                        }
                    }
                }
            }
            
            $("#QRCode").css({
                "opacity": 1
            });
        }

        generateQR = function (options) {
            console.log("data", options.data);
            console.log("data.len", options.data.length);
            qrCode.update({
                width: 350,
                height: 350,
                type: "canvas",
                data: options.data,
                image: "./img/beto_logo.png",
                qrOptions: {
                    typeNumber: 5,
                    errorCorrectionLevel: options.eCL
                },
                dotsOptions: {
                    color: "#fff",
                    type: "dots"
                },
                backgroundOptions: {
                    color: "#00254d",
                },
                imageOptions: {
                    imageSize: 0.5,
                    crossOrigin: "anonymous",
                    margin: 3
                },
                cornersSquareOptions: {
                    color: "#47a0ff",
                    type: "extra-rounded"
                },
                cornersDotOptions: {
                    color: "#47a0ff", 
                    type: "rounded",
                }
            });
            qrCode.append(document.getElementById("QRCode"));
            // qrCode.download({ name: "qr", extension: "png" });
        }

        downloadQR = function() {
            qrCode.download({ name: "qr", extension: "png" });
        }
    </script>
</body>
</html>