<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="og:title" content="BETO-Logo">
    <meta property="og:description" content="BETO QR-Code Design">
    <meta property="og:image" content="https://beto.brlin.org/img/demo.png">
    <meta property="og:url" content="https://beto.brlin.org/index.html">
    <meta name="twitter:card" content="summary_large_image">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:300,400&display=swap">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.3/css/all.css" integrity="sha384-SZXxX4whJ79/gErwcOYf+zWLeJdY/qpuqC4cAa9rOGUstPomtqpuNWT9wdPEn2fk" crossorigin="anonymous">
    <link rel="stylesheet" href="./css/bootstrap.min.css">
    <title>BETO-Logo</title>
    <style>
        html, body {
            padding: 0;
            margin: 0;
            display: flex;
            flex-direction: column;
        }

        .navbar-brand-beto {
            width: 100%;
            background-color: #00254d;
            padding: 0;
            margin: 0;
        }

        .main {
            width: 100%;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
        }

        .options {
            background-color: #c29ffa;
        }

        .QRCode {
            transition: opacity 5s linear;
        }

        .btn-outline-indigo {
            color: #7d5fff;
            background-color: #fff;
            border-color: #7d5fff;
        }

        .btn-outline-indigo:hover {
            color: #fff;
            background-color: #7d5fff;
            border-color: #7d5fff;
        }
    </style>
</head>
<body>
    <header class="navbar-brand-beto">
        <div class="container d-flex justify-content-center">
            <a>
                <img src="./img/beto_logo.png" alt="" width="220" height="88">
            </a>
        </div>
    </header>
    <div class="main bg-white bg-gradient">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-12 col-md-10 col-lg-8 col-xl-6 pt-4 justify-content-center">
                    <div class="input-group">
                        <!-- <button class="btn btn-primary"><i class="fas fa-paste"></i><br/>Paste</button> -->
                        <span class="input-group-text bg-primary text-white" id="addon-wrapping">Data</span>
                        <textarea id="input-Data" class="form-control" placeholder="https://www.beto.com.tw/" aria-label="https://www.beto.com.tw/" aria-label="URL"></textarea>
                    </div>
                </div>
            </div>
            <div class="row justify-content-center">
                <div class="col-12 col-sm-12 col-md-10 col-lg-10 col-xl-8 pt-1 justify-content-start">
                    <div class="accordion" id="accordionOptions">
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingOne">
                                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                                    Main Options
                                </button>
                            </h2>
                            <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne" data-bs-parent="#accordionOptions">
                                <div class="accordion-body">
                                    <form class="row needs-validation g-2" novalidate>
                                        <div class="col-md-5">
                                            <div class="input-group">
                                                <span class="input-group-text" id="inputGroupPrepend">BackGround Color</span>
                                                <input type="color" class="form-control form-control-color" id="input-BackGroundColor" value="#000" title="Dots Color">
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="input-group">
                                                <span class="input-group-text" id="inputGroupPrepend">Width</span>
                                                <input type="number" class="form-control" id="input-Width" title="Width">
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="input-group">
                                                <span class="input-group-text" id="inputGroupPrepend">Height</span>
                                                <input type="number" class="form-control" id="input-Height" title="Height">
                                            </div>
                                        </div>
                                        <div class="col-ms-3 col-md-4">
                                            <div class="input-group">
                                                <span class="input-group-text" id="inputGroupPrepend">Logo</span>
                                                <select class="form-select" id="select-Logo" required>
                                                    <option selected value="square">1</option>
                                                    <option>2</option>
                                                    <option>3</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-ms-3 col-md-4">
                                            <div class="input-group">
                                                <span class="input-group-text" id="inputGroupPrepend">Logo Size</span>
                                                <input type="number" class="form-control" id="input-LogoSize" min="0" max="1" step="0.1" value="0.5">
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingTwo">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                                    Dots Options
                                </button>
                            </h2>
                            <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#accordionOptions">
                                <div class="accordion-body">
                                    <form class="row col-12 needs-validation g-2" novalidate>
                                        <div class="col-md-5">
                                            <div class="input-group">
                                                <span class="input-group-text" id="inputGroupPrepend">Style</span>
                                                <select class="form-select" id="select-DotsStyle" required>
                                                    <option selected value="square">Square</option>
                                                    <option value="dots">Dots</option>
                                                    <option value="rounded">Rounded</option>
                                                    <option value="extra-rounded">Extra Rounded</option>
                                                    <option value="classy">Classy</option>
                                                    <option value="classy-rounded">Classy Rounded</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="input-group">
                                                <span class="input-group-text" id="inputGroupPrepend">Color</span>
                                                <input type="color" class="form-control form-control-color" id="input-DotsColor" value="#000" title="Dots Color">
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingThree">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                                    Corners Square Options
                                </button>
                            </h2>
                            <div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree" data-bs-parent="#accordionOptions">
                                <div class="accordion-body">
                                    <form class="row col-12 needs-validation g-2" novalidate>
                                        <div class="col-md-5">
                                            <div class="input-group">
                                                <span class="input-group-text" id="inputGroupPrepend">Style</span>
                                                <select class="form-select" id="select-CornersSquareStyle" required>
                                                    <option selected value="square">Square</option>
                                                    <option value="dots">Dots</option>
                                                    <option value="extra-rounded">Extra Rounded</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="input-group">
                                                <span class="input-group-text" id="inputGroupPrepend">Color</span>
                                                <input type="color" class="form-control form-control-color" id="input-CornersSquareColor" value="#000" title="Dots Color">
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingFour">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFour" aria-expanded="false" aria-controls="collapseFour">
                                    Corners Dot Options
                                </button>
                            </h2>
                            <div id="collapseFour" class="accordion-collapse collapse" aria-labelledby="headingFour" data-bs-parent="#accordionOptions">
                                <div class="accordion-body">
                                    <form class="row col-12 needs-validation g-2" novalidate>
                                        <div class="col-md-5">
                                            <div class="input-group">
                                                <span class="input-group-text" id="inputGroupPrepend">Style</span>
                                                <select class="form-select" id="select-CornersDotStyle" required>
                                                    <option selected value="square">Square</option>
                                                    <option value="dots">Dots</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="input-group">
                                                <span class="input-group-text" id="inputGroupPrepend">Color</span>
                                                <input type="color" class="form-control form-control-color" id="input-CornersDotColor" value="#000" title="Dots Color">
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingFive">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFive" aria-expanded="false" aria-controls="collapseFive">
                                    Other Options
                                </button>
                            </h2>
                            <div id="collapseFive" class="accordion-collapse collapse" aria-labelledby="headingFive" data-bs-parent="#accordionOptions">
                                <div class="accordion-body">
                                    <form class="row col-12 needs-validation g-2" novalidate>
                                        <div class="col-md-5">
                                            <div class="input-group">
                                                <span class="input-group-text" id="inputGroupPrepend">Type Number</span>
                                                <input type="number" class="form-control" id="input-TypeNumber" min="2" max="40">
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row justify-content-center">
                <div class="col-12 d-flex pt-2 justify-content-center">
                    <button id="button-QRShare" class="btn btn-primary m-1" data-bs-toggle="modal" data-bs-target="#shareModal">
                        <i class="fas fa-share-alt"></i>
                        Share
                    </button>
                    <button id="button-QRGenerate" class="btn btn-success m-1">
                        Update <i class="fas fa-qrcode"></i> Code
                    </button>
                </div>
            </div>
            <div class="row justify-content-center">
                <div class="col-12 col-md-6 pt-2 d-flex justify-content-center">
                    <div class="row justify-content-center">
                        <figure id="QRCode" class="figure rounded m-1 col-12 d-flex justify-content-center" style="transition: opacity 0.25 linear;">
                        </figure>
                    </div>
                </div>
            </div>
            <div class="row justify-content-center">
                <div class="row col-12 col-md-12 col-lg-8 col-xl-8 d-flex pt-2 justify-content-center">
                    <div class="col-9 col-sm-6 col-md-5 justify-content-center">
                        <div class="input-group">
                            <button id="button-QRDownload" class="btn btn-danger"><i class="fas fa-download"></i> Download</button>
                            <select class="form-select btn btn-outline-danger" id="select-QRDoenloadType">
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="pb-2">

            </div>

            <!-- disable -->
            <div class="modal fade" id="shareModal" tabindex="-1" aria-labelledby="shareModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title text-primary" id="shareModalLabel"><i class="fas fa-share-alt-square fa-lg"></i> Share My <i class="fas fa-qrcode"></i> Design!~</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <form>
                                <div class="mb-3">
                                    <label for="share-url" class="col-form-label">My <i class="fas fa-qrcode"></i> Design Link <i class="fas fa-pen" style="color: #7d5fff;"></i></label>
                                    <div class="input-group">
                                        <input type="link" class="form-control" id="share-url" readonly>
                                        <button type="button" class="btn btn-outline-indigo" id="copy_share-url" data-clipboard-target="#share-url"><i class="fas fa-copy"></i></button>
                                    </div>
                                </div>
                                <hr>
                                <div class="m-0 d-flex justify-content-center">
                                    <picture id="qr_picture">

                                    </picture>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script type="text/javascript" src="./js/jquery.min.js"></script>
    <script type="text/javascript" src="./js/qr-code-styling.js"></script>
    <script src="./js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.8/clipboard.min.js"></script>
    <script>
        const qrCode = new QRCodeStyling();
        const qrCode_share = new QRCodeStyling();
        let qrSitting = {};
        let url = new URL(window.location);

        pre_generateQR = function() {
            $("#QRCode").css("opacity", 0);
            
            var errorCorrectionLevelList = ["H", "Q", "M", "L"];
            var typeNumber = $("#input-TypeNumber").val();

            var options={};
            options.data = $("#input-Data").val();
            if(options.data.length<=0){
                options.data="https://www.beto.com.tw/";
            }
            options.backgroundColor = $("#input-BackGroundColor").val();
            options.width = $("#input-Width").val();
            options.height = $("#input-Height").val();
            options.image = $("#select-Logo").val();
            options.imageSize = $("#input-LogoSize").val();
            options.typeNumber = $("#input-TypeNumber").val();
            options.dotsStyle = $("#select-DotsStyle").val();
            options.dotsColor = $("#input-DotsColor").val();
            options.cornersSquareStyle = $("#select-CornersSquareStyle").val();
            options.cornersSquareColor = $("#input-CornersSquareColor").val();
            options.cornersDotStyle = $("#select-CornersDotStyle").val();
            options.cornersDotColor = $("#input-CornersDotColor").val();

            // for(var i in errorCorrectionLevelList){
            //     try {
            //         options.eCL = errorCorrectionLevelList[i];
            //         generateQR(options);
            //         break;
            //     } catch(e_ECL){
            //         console.log(`[Error] errorCorrectionLevel ${options.eCL}`, e_ECL);
            //         try {
            //             ++options.typeNumber;
            //             generateQR(options);
            //         } catch (e_TN) {
            //             console.log(`[Error] Type Number ${options.typeNumber}`, e_TN);
            //         }
            //     }
            // }

            for(var i in errorCorrectionLevelList){
                try {
                    options.eCL = errorCorrectionLevelList[i];
                    generateQR(options);
                    break;
                } catch(e_ECL){
                    console.log(`[Error] errorCorrectionLevel ${options.eCL}`, e_ECL);
                }
            }

            $("#input-TypeNumber").val(options.typeNumber);
            
            $("#QRCode").css({
                "opacity": 1
            });
        }

        generateQR = function (options) {
            // console.log("generateQR - options", options);
            qrSitting = {
                width: options.width,
                height: options.height,
                type: "svg",
                data: options.data,
                qrOptions: {
                    typeNumber: options.typeNumber,
                    errorCorrectionLevel: options.eCL
                },
                dotsOptions: {
                    color: options.dotsColor,
                    type: options.dotsStyle
                },
                backgroundOptions: {
                    color: options.backgroundColor,
                },
                cornersSquareOptions: {
                    color: options.cornersSquareColor,
                    type: options.cornersSquareStyle
                },
                cornersDotOptions: {
                    color: options.cornersDotColor,
                    type: options.cornersDotStyle
                }
            };

            if(options.image !== "null") {
                qrSitting.image = options.image;
                qrSitting.imageOptions = {
                    imageSize: options.imageSize,
                    crossOrigin: "anonymous",
                    margin: 3
                };
            }else{
                qrSitting.image = null;
            }

            qrCode.update(qrSitting);
            qrCode.append(document.getElementById("QRCode"));

            // $("#QRCode svg").attr("width", "100%");
            // $("#QRCode svg").attr("height", "100%");
        }

        downloadQR = function() {
            qrCode.download({ name: "qr", extension: $("#select-QRDoenloadType").val() });
        }

        QRShare = function (mdoal_shareModal) {
            console.log("[Debug] QRShare", mdoal_shareModal)

            var newUrl = url.hostname + url.pathname;
            var uri = "";
            for(var i in items) {
                if(items[i].type === "input" || items[i].type === "select"){
                    uri += `${(uri.length===0 ? "?" : "&")}${i}=${encodeURIComponent($(`#${items[i].type}-${i}`).val())}`;
                }
            }
            // console.log("uri_last", uri);
            console.log(uri);
            var modalLink = mdoal_shareModal.querySelector('.modal-body input');
            modalLink.value = url + uri;


            var qrSitting_png = qrSitting;
            qrSitting_png.type = "canvas";
            qrCode_share.update(qrSitting_png);
            qrCode_share.append(document.getElementById("qr_picture"));
        }

        const items = {
            "Data": {
                type: "input", 
                event: {
                    "onchange": () => pre_generateQR,
                }
            }, 
            "BackGroundColor": {
                type: "input", 
                definedValue: "#00254d",
                event: {
                    "onchange": () => pre_generateQR,
                }
            }, 
            "Width": {
                type: "input", 
                definedValue: 350,
                event: {
                    "onchange": () => pre_generateQR,
                }
            }, 
            "Height": {
                type: "input", 
                definedValue: 350,
                event: {
                    "onchange": () => pre_generateQR,
                }
            }, 
            "Logo": {
                type: "select", 
                event: {
                    "onchange": () => pre_generateQR,
                },
                options: [
                    {key: "無", value: null},
                    {key: "1", value: "./img/beto_logo.png", isSelect: true},
                    {key: "2", value: "./img/beto_logo_W.png"},
                    {key: "3", value: "./img/beto_logo2.png"},
                ],
            }, 
            "DotsStyle": {
                type: "select", 
                definedValue: "dots",
                event: {
                    "onchange": () => pre_generateQR,
                }
            }, 
            "DotsColor": {
                type: "input", 
                definedValue: "#ffffff",
                event: {
                    "onchange": () => pre_generateQR,
                }
            }, 
            "CornersSquareStyle": {
                type: "select", 
                definedValue: "extra-rounded",
                event: {
                    "onchange": () => pre_generateQR,
                }
            }, 
            "CornersSquareColor": {
                type: "input", 
                definedValue: "#47a0ff",
                event: {
                    "onchange": () => pre_generateQR,
                }
            }, 
            "CornersDotStyle": {
                type: "select", 
                definedValue: "dots",
                event: {
                    "onchange": () => pre_generateQR,
                }
            }, 
            "CornersDotColor": {
                type: "input", 
                definedValue: "#47a0ff",
                event: {
                    "onchange": () => pre_generateQR,
                }
            }, 
            "QRGenerate": {
                type: "button",
                event: {
                    "onclick": () => pre_generateQR,
                },
            },
            "QRDownload": {
                type: "button",
                event: {
                    "onclick": () => downloadQR,
                },
            },
            "QRDoenloadType": {
                type: "select",
                options: [
                    {key: "Png", value: "png", isSelect: true}, 
                    {key: "Jpeg", value: "jpeg"}, 
                    {key: "Webp", value: "webp"}, 
                    {key: "Svg", value: "svg"}
                ],
            },
            "QRShare": {
                type: "button",
                event: {
                },
            },
            "TypeNumber": {
                type: "input", 
                definedValue: "5",
                attr: {
                    "value": "5",
                },
                event: {
                    "onchange": () => pre_generateQR
                }
            },
            "LogoSize": {
                type: "input",
                definedValue: "0.5",
                event: {
                    "onchange": () => pre_generateQR
                }
            },
        };

        document.addEventListener("DOMContentLoaded", function(){
            console.log("Loaded");

            set_itemsSitting();
            
            set_urlParam(url);

            set_itemsEvents();

            pre_generateQR();

            var shareModal = document.getElementById("shareModal");
            var clipboard = new ClipboardJS('#copy_share-url');

            shareModal.addEventListener("show.bs.modal", function (event) {
                
                QRShare(shareModal);
            });
        });

        set_itemsSitting = function (type) {
            for(var item_key in items) {
                if(typeof items[item_key].definedValue !== "undefined") {
                    // console.log("setValue", items[item_key].definedValue);
                    $(`#${items[item_key].type}-${item_key}`).val(items[item_key].definedValue);
                }
                if(typeof items[item_key].options !== "undefined"){
                    $(`#${items[item_key].type}-${item_key}`).empty();
                    for(var i in items[item_key].options){
                        $(`#${items[item_key].type}-${item_key}`).append(`<option value="${items[item_key].options[i].value}"${(items[item_key].options[i].isSelect ? " selected" : "")}>${items[item_key].options[i].key}</option>`)
                        // $(`#${items[item_key].type}-${item_key}`).append(`<option value="${items[item_key].options[key]}">${key}</option>`)
                    }
                }
            }
        }

        set_itemsEvents = function () {
            for(var item_key in items) {
                if(typeof items[item_key].event !== "undefined"){
                    for(var event_key in items[item_key].event) {
                        if(event_key === "onchange"){
                            $(`#${items[item_key].type}-${item_key}`).on("change", items[item_key].event[event_key]());
                        }else if(event_key === "onclick"){
                            $(`#${items[item_key].type}-${item_key}`).on("click", items[item_key].event[event_key]());
                        }
                        // console.log(event_key, items[item_key].event[event_key])
                    }
                }
            }
        }

        set_urlParam = function (url) {
            let params = url.searchParams;
            for (let pair of params.entries()) {
                if(typeof items[pair[0]] !== "undefined"){
                    // console.log(pair[0], pair[1])
                    $(`#${items[pair[0]].type}-${pair[0]}`).val(pair[1]);
                }
            }
        }
    </script>
</body>
</html>